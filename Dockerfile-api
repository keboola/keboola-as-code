# Build container
FROM golang:1.18 AS buildContainer
WORKDIR /app
COPY . .
#flags: -s -w to remove symbol table and debug info
RUN make tools
RUN make build-templates-api

# Production container
FROM alpine
RUN apk add -U --no-cache ca-certificates git

COPY --from=buildContainer /app/target/templates-api/server /app/server
WORKDIR /app

ENV HOST 0.0.0.0
ENV PORT 8000
EXPOSE 8000

# Note: keboola-dev is temporary repository, until we will know to switch repositories by a project feature.
CMD ["/app/server", "--http-host=0.0.0.0", "--http-port=8000", "--repositories", "keboola|https://github.com/keboola/keboola-as-code-templates.git|main;keboola-dev|https://github.com/keboola/keboola-as-code-templates.git|dev"]
